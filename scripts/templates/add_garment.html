{% extends "base.html" %}

{% block title %}Add Garment - Garment Manager{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-plus"></i> Add New Garment
                </h5>
            </div>
            <div class="card-body">
                <form method="POST" {% if edit_mode and garment %}action="{{ url_for('edit_garment', garment_id=garment.id) }}"{% endif %}>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="user_email" class="form-label">User Email *</label>
                                <select class="form-select" id="user_email" name="user_email" required>
                                    <option value="">Select a user...</option>
                                    {% for user in users %}
                                    <option value="{{ user.email }}" {% if edit_mode and garment and garment.user_id == user.id %}selected{% endif %}>{{ user.email }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="brand_name" class="form-label">Brand *</label>
                                <select class="form-select" id="brand_name" name="brand_name" required>
                                    <option value="">Select brand...</option>
                                    {% for brand in brands %}
                                    <option value="{{ brand.name }}" {% if edit_mode and garment and garment.brand_id == brand.id %}selected{% endif %}>{{ brand.name }}</option>
                                    {% endfor %}
                                </select>
                                <div class="form-text">
                                    <small>Need a new brand? Contact an admin or use the <a href="http://localhost:5002/admin/login" target="_blank">Admin Interface</a></small>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="category_name" class="form-label">Category *</label>
                                <select class="form-select" id="category_name" name="category_name" required>
                                    <option value="">Select category...</option>
                                    {% for category in categories %}
                                    <option value="{{ category.name }}" {% if edit_mode and garment and garment.category_id == category.id %}selected{% endif %}>{{ category.name }}</option>
                                    {% endfor %}
                                </select>
                                <div class="form-text">
                                    <small>Need a new category? Contact an admin or use the <a href="http://localhost:5002/admin/login" target="_blank">Admin Interface</a></small>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="subcategory_name" class="form-label">Subcategory</label>
                                <select class="form-select" id="subcategory_name" name="subcategory_name">
                                    <option value="">Select subcategory (optional)...</option>
                                    {% for subcategory in subcategories %}
                                    <option value="{{ subcategory.name }}" {% if edit_mode and garment and garment.subcategory_id == subcategory.id %}selected{% endif %}>{{ subcategory.name }}</option>
                                    {% endfor %}
                                </select>
                                <div class="form-text">
                                    <small>Need a new subcategory? Contact an admin or use the <a href="http://localhost:5002/admin/login" target="_blank">Admin Interface</a></small>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="gender" class="form-label">Gender *</label>
                                <select class="form-select" id="gender" name="gender" required>
                                    <option value="">Select gender...</option>
                                    <option value="Male" {% if edit_mode and garment and garment.gender == 'Male' %}selected{% endif %}>Male</option>
                                    <option value="Female" {% if edit_mode and garment and garment.gender == 'Female' %}selected{% endif %}>Female</option>
                                    <option value="Unisex" {% if edit_mode and garment and garment.gender == 'Unisex' %}selected{% endif %}>Unisex</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="size_label" class="form-label">Size *</label>
                                <select class="form-select" id="size_label" name="size_label" required>
                                    <option value="">Select size...</option>
                                    {% for size in available_sizes %}
                                    <option value="{{ size }}" {% if edit_mode and garment and garment.size_label == size %}selected{% endif %}>{{ size }}</option>
                                    {% endfor %}
                                    <option value="Other">Other (specify below)</option>
                                </select>
                                <div id="other-size-input" class="mt-2" style="display: none;">
                                    <input type="text" class="form-control" id="other_size_label" name="other_size_label" 
                                           placeholder="Enter size (e.g., 2XL, 48, etc.)" {% if edit_mode and garment and garment.size_label not in available_sizes %}value="{{ garment.size_label }}"{% endif %}>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="fit_type" class="form-label">Fit Type *</label>
                                <select class="form-select" id="fit_type" name="fit_type" required>
                                    <option value="">Select fit type...</option>
                                    <option value="NA" {% if edit_mode and garment and garment.fit_type == 'NA' %}selected{% endif %}>NA</option>
                                    <option value="Regular" {% if edit_mode and garment and garment.fit_type == 'Regular' %}selected{% endif %}>Regular</option>
                                    <option value="Slim" {% if edit_mode and garment and garment.fit_type == 'Slim' %}selected{% endif %}>Slim</option>
                                    <option value="Tall" {% if edit_mode and garment and garment.fit_type == 'Tall' %}selected{% endif %}>Tall</option>
                                </select>
                            </div>

                            <div class="mb-3">
                                <label for="product_name" class="form-label">Product Name</label>
                                <input type="text" class="form-control" id="product_name" name="product_name" 
                                       placeholder="e.g., Blue cotton t-shirt, Nike running shoes, or leave blank" {% if edit_mode and garment %}value="{{ garment.product_name }}"{% endif %}>
                                <div class="form-text">
                                    <small>
                                        <strong>Tips:</strong> Use descriptive names like "Blue cotton t-shirt", "Black dress pants", 
                                        "Nike running shoes", or "Red polo shirt". You can leave this blank if you don't know the exact name.
                                    </small>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="product_url" class="form-label">Product URL</label>
                                <input type="url" class="form-control" id="product_url" name="product_url" 
                                       placeholder="https://example.com/product/123" {% if edit_mode and garment %}value="{{ garment.product_url }}"{% endif %}>
                            </div>
                        </div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary me-md-2">
                            <i class="fas fa-times"></i> Cancel
                        </a>
                        {% if edit_mode and garment %}
                        <form method="POST" action="{{ url_for('delete_garment', garment_id=garment.id) }}" style="display:inline;">
                            <button type="submit" class="btn btn-danger me-md-2" onclick="return confirm('Are you sure you want to delete this garment?');">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </form>
                        {% endif %}
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> {% if edit_mode %}Update Garment{% else %}Add Garment{% endif %}
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Show/hide "Other" input fields
    document.addEventListener('DOMContentLoaded', function() {
        const brandSelect = document.getElementById('brand_name');
        const categorySelect = document.getElementById('category_name');
        const subcategorySelect = document.getElementById('subcategory_name');
        const genderSelect = document.getElementById('gender');
        const sizeSelect = document.getElementById('size_label');
        const otherSizeInput = document.getElementById('other-size-input');

        // Helper to update size dropdown
        function updateSizes() {
            const brand = brandSelect.value;
            const category = categorySelect.value;
            const gender = genderSelect.value;
            const subcategory = subcategorySelect.value;
            if (!brand || !category || !gender) {
                sizeSelect.innerHTML = '<option value="">Select size...</option><option value="Other">Other (specify below)</option>';
                return;
            }
            fetch(`/get_sizes?brand_name=${encodeURIComponent(brand)}&category_name=${encodeURIComponent(category)}&gender=${encodeURIComponent(gender)}&subcategory_name=${encodeURIComponent(subcategory)}`)
                .then(response => response.json())
                .then(data => {
                    let options = '<option value="">Select size...</option>';
                    if (data.sizes && data.sizes.length > 0) {
                        data.sizes.forEach(size => {
                            options += `<option value="${size}">${size}</option>`;
                        });
                    }
                    options += '<option value="Other">Other (specify below)</option>';
                    sizeSelect.innerHTML = options;
                });
        }

        // Listen for changes
        brandSelect.addEventListener('change', updateSizes);
        categorySelect.addEventListener('change', updateSizes);
        subcategorySelect.addEventListener('change', updateSizes);
        genderSelect.addEventListener('change', updateSizes);

        // Call updateSizes on page load to populate dropdown immediately
        updateSizes();

        // Show/hide "Other" input fields
        sizeSelect.addEventListener('change', function() {
            if (this.value === 'Other') {
                otherSizeInput.style.display = 'block';
            } else {
                otherSizeInput.style.display = 'none';
            }
        });
    });
</script>
{% endblock %} 